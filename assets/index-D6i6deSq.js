var Ut=Object.defineProperty;var Bt=c=>{throw TypeError(c)};var Kt=(c,t,s)=>t in c?Ut(c,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[t]=s;var ut=(c,t,s)=>Kt(c,typeof t!="symbol"?t+"":t,s),pt=(c,t,s)=>t.has(c)||Bt("Cannot "+s);var e=(c,t,s)=>(pt(c,t,"read from private field"),s?s.call(c):t.get(c)),o=(c,t,s)=>t.has(c)?Bt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(c):t.set(c,s),p=(c,t,s,i)=>(pt(c,t,"write to private field"),i?i.call(c,s):t.set(c,s),s),a=(c,t,s)=>(pt(c,t,"access private method"),s);var ft=(c,t,s,i)=>({set _(r){p(c,t,r,s)},get _(){return e(c,t,i)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();var Y,N,T;class Jt{constructor(t){o(this,Y);o(this,N);o(this,T);if(!Number.isInteger(t)||t<1)throw new Error("Ship length must be a positive integer");p(this,Y,t),p(this,N,0),p(this,T,[])}hit(){this.isSunk||ft(this,N)._++}addCoordinate(t,s){e(this,T).push([t,s])}clearCoordinates(){p(this,T,[])}get isSunk(){return e(this,N)>=e(this,Y)}get length(){return e(this,Y)}get hits(){return e(this,N)}get coordinatesSnapshot(){return e(this,T).map(([t,s])=>[t,s])}}Y=new WeakMap,N=new WeakMap,T=new WeakMap;var f,m,H,S,L,X,C,g,St,U,K,gt,Z,mt,xt,J,Nt,M,Q,W;class Qt{constructor(t,s,i,r){o(this,g);o(this,f);o(this,m);o(this,H);o(this,S);o(this,L,!1);o(this,X,!1);o(this,C,null);o(this,U,()=>{e(this,S).publish("clearDraggableAttr"),e(this,S).publish("disableDragAndDropListeners"),p(this,L,!0),a(this,g,Z).call(this),e(this,S).publish("updateSelfStats",e(this,f).fleetSnapshot),e(this,S).publish("updateOpponentStats",e(this,m).fleetSnapshot)});o(this,K,()=>{p(this,L,!1),p(this,C,null),p(this,X,!1),e(this,f).clearBoard(),e(this,m).clearBoard(),a(this,g,St).call(this),e(this,S).publish("enableDragAndDropListeners"),e(this,S).publish("updateSelfStats",e(this,f).fleetSnapshot),e(this,S).publish("updateOpponentStats",e(this,m).fleetSnapshot)});o(this,J,async({x:t,y:s})=>{if(!e(this,X)){if(!e(this,L)&&!e(this,C)){a(this,g,Nt).call(this,t,s);return}if(e(this,C)===e(this,f)){const i=e(this,f).makeAttack(e(this,m),t,s);if(e(this,S).publish("updateOpponentBoard",e(this,m).boardSnapshot),e(this,S).publish("updateOpponentStats",e(this,m).fleetSnapshot),e(this,m).areAllShipsSunk){a(this,g,gt).call(this);return}if(i.wasAlreadyHit)return;i.isShip||a(this,g,Z).call(this)}e(this,C)===e(this,m)&&e(this,M).call(this)}});o(this,M,async()=>{await(i=>new Promise(r=>setTimeout(r,i)))(500);const s=e(this,m).makeAttack(e(this,f));if(s){if(e(this,S).publish("updateSelfBoard",e(this,f).boardSnapshot),e(this,S).publish("clearDraggableAttr"),e(this,S).publish("updateSelfStats",e(this,f).fleetSnapshot),e(this,f).areAllShipsSunk){a(this,g,gt).call(this);return}if(s.wasAlreadyHit){console.log("attack.wasAlreadyHit"),await e(this,M).call(this);return}if(!s.isShip){a(this,g,Z).call(this);return}await e(this,M).call(this)}});o(this,Q,({x:t,y:s,e:i})=>{if(e(this,L))return;const r=e(this,f).getShipAtCoordinate(t,s);r&&e(this,S).publish("ghostCell",{coordinates:r.coordinatesSnapshot,e:i})});o(this,W,({draggedX:t,draggedY:s,targetX:i,targetY:r})=>{if(e(this,L))return;const n=e(this,f).getShipAtCoordinate(t,s);if(!n)return;const h=e(this,f).getShipDirection(n);if(!e(this,f).rePlaceShip(n,i,r,h)){e(this,S).publish("shakeShip",n.coordinatesSnapshot);return}e(this,S).publish("resetDraggedElement",e(this,f).boardSnapshot),e(this,S).publish("updateSelfBoard",e(this,f).boardSnapshot)});p(this,f,t),p(this,m,s),p(this,S,r),p(this,H,i)}init(){e(this,H).init(),a(this,g,St).call(this),a(this,g,xt).call(this)}}f=new WeakMap,m=new WeakMap,H=new WeakMap,S=new WeakMap,L=new WeakMap,X=new WeakMap,C=new WeakMap,g=new WeakSet,St=function(){a(this,g,mt).call(this,e(this,f)),a(this,g,mt).call(this,e(this,m)),e(this,H).updateSelfBoard(e(this,f).boardSnapshot),e(this,H).updateOpponentBoard(e(this,m).boardSnapshot)},U=new WeakMap,K=new WeakMap,gt=function(){const t=e(this,C)===e(this,f)?"self":"opponent";e(this,S).publish("gameOver",t),p(this,X,!0)},Z=function(){e(this,S).publish("switchTurn"),p(this,C,e(this,C)===e(this,f)?e(this,m):e(this,f))},mt=function(t){const s={4:1,3:2,2:3,1:4};for(const[i,r]of Object.entries(s))for(let n=0;n<r;n++)t.placeShipAtRandom(new Jt(Number(i)))},xt=function(){const t={gameStart:e(this,U),restartGame:e(this,K),cellClick:e(this,J),dragStart:e(this,Q),drop:e(this,W)};for(const[s,i]of Object.entries(t))e(this,S).subscribe(s,i)},J=new WeakMap,Nt=function(t,s){const i=e(this,f).getShipAtCoordinate(t,s);if(!i)return;e(this,f).changeShipDirection(i)||e(this,S).publish("shakeShip",i.coordinatesSnapshot),e(this,S).publish("updateSelfBoard",e(this,f).boardSnapshot)},M=new WeakMap,Q=new WeakMap,W=new WeakMap;var b,_,Ht;class Tt{constructor(t){o(this,_);o(this,b);p(this,b,t)}placeShip(t,s,i,{dx:r,dy:n}){return e(this,b).placeShip(t,s,i,{dx:r,dy:n})}placeShipAtRandom(t){let s=!1;for(;!s;){const i=a(this,_,Ht).call(this);if(i.length<1)return!1;const[r,n]=i[Math.floor(Math.random()*i.length)],h=Math.random()<.5,d=h?0:1,k=h?1:0;s=this.placeShip(t,r,n,{dx:d,dy:k})}return s}rePlaceShip(t,s,i,r){return e(this,b).rePlaceShip(t,s,i,r)}receiveAttack(t,s){return e(this,b).receiveAttack(t,s)}getShipAtCoordinate(t,s){return e(this,b).getShipAtCoordinate(t,s)}getShipDirection(t){return e(this,b).getShipDirection(t)}changeShipDirection(t){return e(this,b).changeShipDirection(t)}clearBoard(){e(this,b).clearBoard()}get areAllShipsSunk(){return e(this,b).areAllShipsSunk}get boardSnapshot(){return e(this,b).boardSnapshot}get fleetSnapshot(){return e(this,b).fleetSnapshot}get hasLost(){return e(this,b).areAllShipsSunk}}b=new WeakMap,_=new WeakSet,Ht=function(){const t=[];for(const[s,i]of this.boardSnapshot.entries())for(const[r,n]of i.entries())n||t.push([s,r]);return t};var tt,It;class Wt extends Tt{constructor(){super(...arguments);o(this,tt)}makeAttack(s){const i=a(this,tt,It).call(this,s.boardSnapshot);if(i.length===0)return null;const[r,n]=i[Math.floor(Math.random()*i.length)];return s.receiveAttack(r,n)}}tt=new WeakSet,It=function(s){const i=[];for(const[r,n]of s.entries())for(const[h,d]of n.entries())d!=null&&d.hit||i.push([r,h]);return i};var B,A,y,I,w,u,bt,Rt,Pt,vt,x,At,Yt,Xt,Mt,yt;const O=class O{constructor(t=10){o(this,u);o(this,B);o(this,A);o(this,y);o(this,I);p(this,B,t),p(this,A,a(this,u,bt).call(this,t)),p(this,y,new Set),p(this,I,0)}placeShip(t,s,i,r=e(O,w).HORIZONTAL){return a(this,u,Rt).call(this,t,s,i,r)?(a(this,u,Pt).call(this,t,s,i,r),e(this,y).add(t),!0):!1}rePlaceShip(t,s,i,r){if(!e(this,y).has(t))return!1;const[n,h,d]=a(this,u,yt).call(this,t),k=r||d;return a(this,u,vt).call(this,t),this.placeShip(t,s,i,k)?!0:(this.placeShip(t,n,h,d),!1)}changeShipDirection(t){if(!e(this,y).has(t)||t.length<2)return!1;const[s,i,r]=a(this,u,yt).call(this,t),n=a(this,u,Mt).call(this,r);return a(this,u,vt).call(this,t),this.placeShip(t,s,i,n)?!0:(this.placeShip(t,s,i,r),!1)}receiveAttack(t,s){if(a(this,u,x).call(this,t,s))return{isShip:!1,wasAlreadyHit:!1};const i=e(this,A)[t][s];if((i==null?void 0:i.hit)===!0)return{isShip:!!(i!=null&&i.ship),wasAlreadyHit:!0};if(!(i!=null&&i.ship))return e(this,A)[t][s]={hit:!0},{isShip:!1,wasAlreadyHit:!1};const r=i.ship,n=r.isSunk;return i.hit=!0,r.hit(),!n&&r.isSunk&&ft(this,I)._++,{isShip:!0,wasAlreadyHit:!1}}getShipAtCoordinate(t,s){if(a(this,u,x).call(this,t,s))return null;const i=e(this,A)[t][s];return(i==null?void 0:i.ship)||null}getShipDirection(t){const s=t.coordinatesSnapshot;if(s.length===1)return e(O,w).HORIZONTAL;const[i,r]=s[0],[n,h]=s[1];return i===n?e(O,w).HORIZONTAL:r===h?e(O,w).VERTICAL:null}clearBoard(){p(this,A,a(this,u,bt).call(this,e(this,B))),e(this,y).clear(),p(this,I,0)}get areAllShipsSunk(){return e(this,y).size>0&&e(this,I)===e(this,y).size}get boardSnapshot(){return e(this,A).map(t=>t.map(s=>s?{...s}:null))}get fleetSnapshot(){return[...e(this,y)].map(t=>({length:t.length,hits:t.hits,isSunk:t.isSunk,coordinatesSnapshot:t.coordinatesSnapshot}))}get size(){return e(this,B)}};B=new WeakMap,A=new WeakMap,y=new WeakMap,I=new WeakMap,w=new WeakMap,u=new WeakSet,bt=function(t){return[...Array(t)].map(()=>new Array(t).fill(null))},Rt=function(t,s,i,r){if(!t||e(this,y).has(t)||!a(this,u,At).call(this,r))return!1;const n=s+r.dx*(t.length-1),h=i+r.dy*(t.length-1);return!(a(this,u,x).call(this,s,i)||a(this,u,x).call(this,n,h)||!a(this,u,Yt).call(this,t,s,i,r))},Pt=function(t,s,i,r){t.clearCoordinates();for(let n=0;n<t.length;n++){const h=s+r.dx*n,d=i+r.dy*n;e(this,A)[h][d]={ship:t,hit:!1},t.addCoordinate(h,d)}},vt=function(t){var i;const s=t.coordinatesSnapshot;if(!(!s||s.length===0)){for(const[r,n]of s)!a(this,u,x).call(this,r,n)&&((i=e(this,A)[r][n])==null?void 0:i.ship)===t&&(e(this,A)[r][n]=null);t.clearCoordinates(),e(this,y).delete(t)}},x=function(t,s){return t<0||s<0||t>=e(this,B)||s>=e(this,B)},At=function(t){const{dx:s,dy:i}=t,{HORIZONTAL:r,VERTICAL:n}=e(O,w);return s===r.dx&&i===r.dy||s===n.dx&&i===n.dy},Yt=function(t,s,i,r){for(let n=0;n<t.length;n++){const h=s+r.dx*n,d=i+r.dy*n;if(e(this,A)[h][d]!==null||a(this,u,Xt).call(this,h,d,t))return!1}return!0},Xt=function(t,s,i=null){const r=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[n,h]of r){const d=t+n,k=s+h;if(a(this,u,x).call(this,d,k))continue;const j=e(this,A)[d][k];if(j!=null&&j.ship&&j.ship!==i)return!0}return!1},Mt=function(t){const{HORIZONTAL:s,VERTICAL:i}=e(O,w);return a(this,u,At).call(this,t)?t.dx===s.dx?i:s:null},yt=function(t){const s=t.coordinatesSnapshot;if(!s||s.length===0)return null;const[i,r]=s[0],n=this.getShipDirection(t);return[i,r,n]},o(O,w,{HORIZONTAL:{dx:0,dy:1},VERTICAL:{dx:1,dy:0}});let F=O;class _t extends Tt{makeAttack(t,s,i){return t.receiveAttack(s,i)}}var R,$,z;class te{constructor(){o(this,$);o(this,R);p(this,R,new Map)}subscribe(t,s){const i=a(this,$,z).call(this,t);i.add(s),e(this,R).set(t,i)}publish(t,s){const i=a(this,$,z).call(this,t);for(const r of i)r(s)}unsubscribe(t,s){const i=a(this,$,z).call(this,t);i.delete(s),i.size===0&&e(this,R).delete(t)}}R=new WeakMap,$=new WeakSet,z=function(t){return e(this,R).get(t)||new Set};var D,G,v,E,P,l,$t,jt,Gt,Et,kt,q,et,V,st,it,qt,Ct,rt,Dt,nt,at,Vt,Ot,Zt,ot,ht,lt,wt,zt,Lt,ct,dt;class ee{constructor(t){o(this,l);o(this,D);o(this,G);o(this,v);o(this,E);o(this,P,null);ut(this,"updateSelfBoard",t=>a(this,l,Et).call(this,t,e(this,v)));ut(this,"updateOpponentBoard",t=>a(this,l,Et).call(this,t,e(this,E),!0));o(this,q,()=>{a(this,l,kt).call(this,!0)});o(this,et,()=>{a(this,l,kt).call(this,!1)});o(this,V,t=>{const s=t.target.closest(".cell");if(!s)return;const{x:i,y:r}=s.dataset;e(this,D).publish("cellClick",{x:+i,y:+r})});o(this,st,t=>{const s=t.target.closest(".ship");if(!s){t.preventDefault();return}p(this,P,s);const{x:i,y:r}=s.dataset;e(this,D).publish("dragStart",{x:+i,y:+r,e:t})});o(this,it,t=>{const s=t.target.closest(".cell");if(!s)return;t.preventDefault();const{x:i,y:r}=e(this,P).dataset,{x:n,y:h}=s.dataset;e(this,D).publish("drop",{draggedX:+i,draggedY:+r,targetX:+n,targetY:+h})});o(this,rt,t=>{t.target.remove(),e(this,D).publish("gameStart")});o(this,nt,()=>{const t=[e(this,v),e(this,E)];for(const s of t)s.classList.contains("disabled")?s.classList.remove("disabled"):s.classList.add("disabled")});o(this,at,t=>{const s=[e(this,v),e(this,E)];for(const r of s)r.classList.add("disabled");const i={self:"You win!",opponent:"You lost!"};a(this,l,Vt).call(this,i[t])});o(this,ot,()=>{for(const t of e(this,v).querySelectorAll(".cell"))t.removeAttribute("draggable")});o(this,ht,t=>{for(const[s,i]of t){const r=e(this,v).querySelector(`[data-x="${s}"][data-y="${i}"]`);r==null||r.classList.add("shake"),r==null||r.addEventListener("animationend",()=>r.classList.remove("shake"),{once:!0})}});o(this,lt,()=>{var t;(t=e(this,P))==null||t.removeAttribute("draggable"),p(this,P,null)});o(this,ct,t=>a(this,l,Lt).call(this,t,e(this,v)));o(this,dt,t=>a(this,l,Lt).call(this,t,e(this,E)));p(this,G,document.getElementById("app")),p(this,D,t)}init(t=10){a(this,l,$t).call(this,t),a(this,l,Ct).call(this),a(this,l,jt).call(this),a(this,l,Gt).call(this)}get selfBoardEl(){return e(this,v)}get opponentBoardEl(){return e(this,E)}}D=new WeakMap,G=new WeakMap,v=new WeakMap,E=new WeakMap,P=new WeakMap,l=new WeakSet,$t=function(t){p(this,v,a(this,l,Dt).call(this,"self")),p(this,E,a(this,l,Dt).call(this,"opponent",!0)),a(this,l,Ot).call(this,e(this,v),t),a(this,l,Ot).call(this,e(this,E),t)},jt=function(){e(this,v).addEventListener("click",e(this,V)),e(this,E).addEventListener("click",e(this,V)),e(this,q).call(this)},Gt=function(){const t={updateSelfBoard:this.updateSelfBoard,updateOpponentBoard:this.updateOpponentBoard,shakeShip:e(this,ht),ghostCell:a(this,l,qt),resetDraggedElement:e(this,lt),clearDraggableAttr:e(this,ot),disableDragAndDropListeners:e(this,et),enableDragAndDropListeners:e(this,q),switchTurn:e(this,nt),gameOver:e(this,at),updateSelfStats:e(this,ct),updateOpponentStats:e(this,dt)};for(const[s,i]of Object.entries(t))e(this,D).subscribe(s,i)},Et=function(t,s,i=!1){a(this,l,Zt).call(this,s);for(const[r,n]of t.entries())for(const[h,d]of n.entries()){const k=s.querySelector(`[data-x="${r}"][data-y="${h}"]`);d!=null&&d.hit?k.classList.add(d.ship?"hit":"miss"):!i&&(d!=null&&d.ship)&&(k.classList.add("ship"),k.draggable=!0)}},kt=function(t){const s=t?"addEventListener":"removeEventListener",i={dragstart:e(this,st),dragenter:a(this,l,wt),dragover:a(this,l,wt),drop:e(this,it)};for(const[r,n]of Object.entries(i))e(this,v)[s](r,n)},q=new WeakMap,et=new WeakMap,V=new WeakMap,st=new WeakMap,it=new WeakMap,qt=function({coordinates:t,e:s}){const i=t[0][0]===t.at(-1)[0],r=document.createElement("div"),n=t.length,h=2.2;r.className="ghost",r.style.width=`${i?n*h:h}em`,r.style.height=`${i?h:n*h}em`,document.body.appendChild(r),s.dataTransfer.setDragImage(r,0,0),setTimeout(()=>r.remove(),0)},Ct=function(){const t=document.createElement("button");t.textContent="Start",t.className="start",t.addEventListener("click",e(this,rt)),e(this,E).parentNode.appendChild(t)},rt=new WeakMap,Dt=function(t,s=!1){const i=document.createElement("div"),r=document.createElement("div");return i.className=`battlefield battlefied_${t}`,r.className=`board ${t} ${s?"disabled":""}`,i.appendChild(r),e(this,G).appendChild(i),r},nt=new WeakMap,at=new WeakMap,Vt=function(t){const s=document.createElement("div");s.className="modal-overlay";const i=document.createElement("div");i.className="modal-content";const r=document.createElement("p");r.textContent=t;const n=document.createElement("button");n.className="restart-btn",n.textContent="Restart",n.addEventListener("click",h=>{e(this,D).publish("restartGame");const d=h.target.closest(".modal-overlay");d==null||d.remove(),e(this,v).classList.remove("disabled"),a(this,l,Ct).call(this)}),i.appendChild(r),i.appendChild(n),s.appendChild(i),document.querySelector("body").appendChild(s)},Ot=function(t,s){const i=document.createDocumentFragment();for(let r=0;r<s;r++)for(let n=0;n<s;n++){const h=document.createElement("div");h.classList.add("cell"),h.dataset.x=r,h.dataset.y=n,i.appendChild(h)}t.appendChild(i)},Zt=function(t){for(const s of t.querySelectorAll(".cell"))s.classList.remove("ship","hit","miss"),s.removeAttribute("draggable")},ot=new WeakMap,ht=new WeakMap,lt=new WeakMap,wt=function(t){t.target.closest(".cell")&&t.preventDefault()},zt=function(t){const s=document.createElement("div");s.className="stats";const i=document.createElement("div");i.className="ships",s.appendChild(i);const r=t.parentNode;return t===e(this,E)?r.append(s):r.prepend(s),i},Lt=function(t,s){let i=s.parentNode.querySelector(".ships");i?i.innerHTML="":i=a(this,l,zt).call(this,s);for(const r of t){const n=document.createElement("div");n.className="ship__preview";for(let h=0;h<r.length;h++){const d=document.createElement("div");d.className=`ship__preview__part ${r.isSunk?"sunk":""}`,n.appendChild(d)}i.prepend(n)}},ct=new WeakMap,dt=new WeakMap;const Ft=new te,se=new F,ie=new _t(se),re=new F,ne=new Wt(re),ae=new ee(Ft),oe=new Qt(ie,ne,ae,Ft);oe.init();
