var Vt=Object.defineProperty;var wt=l=>{throw TypeError(l)};var Zt=(l,t,e)=>t in l?Vt(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var ct=(l,t,e)=>Zt(l,typeof t!="symbol"?t+"":t,e),dt=(l,t,e)=>t.has(l)||wt("Cannot "+e);var s=(l,t,e)=>(dt(l,t,"read from private field"),e?e.call(l):t.get(l)),o=(l,t,e)=>t.has(l)?wt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(l):t.set(l,e),p=(l,t,e,i)=>(dt(l,t,"write to private field"),i?i.call(l,e):t.set(l,e),e),a=(l,t,e)=>(dt(l,t,"access private method"),e);var ut=(l,t,e,i)=>({set _(r){p(l,t,r,e)},get _(){return s(l,t,i)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();var P,T,N;class zt{constructor(t){o(this,P);o(this,T);o(this,N);if(!Number.isInteger(t)||t<1)throw new Error("Ship length must be a positive integer");p(this,P,t),p(this,T,0),p(this,N,[])}hit(){this.isSunk||ut(this,T)._++}addCoordinate(t,e){s(this,N).push([t,e])}clearCoordinates(){p(this,N,[])}get isSunk(){return s(this,T)>=s(this,P)}get length(){return s(this,P)}get hits(){return s(this,T)}get coordinatesSnapshot(){return s(this,N).map(([t,e])=>[t,e])}}P=new WeakMap,T=new WeakMap,N=new WeakMap;var f,y,H,S,O,X,C,g,pt,U,K,ft,Z,gt,Lt,J,M,Ot,Q,W;class Ft{constructor(t,e,i,r){o(this,g);o(this,f);o(this,y);o(this,H);o(this,S);o(this,O,!1);o(this,X,!1);o(this,C,null);o(this,U,()=>{s(this,S).publish("clearDraggableAttr"),s(this,S).publish("disableDragAndDropListeners"),p(this,O,!0),a(this,g,Z).call(this)});o(this,K,()=>{p(this,O,!1),p(this,C,null),p(this,X,!1),s(this,f).clearBoard(),s(this,y).clearBoard(),a(this,g,pt).call(this),s(this,S).publish("enableDragAndDropListeners")});o(this,J,async({x:t,y:e})=>{if(!s(this,X)){if(!s(this,O)&&!s(this,C)){const i=s(this,f).getShipAtCoordinate(t,e);if(!i)return;a(this,g,Ot).call(this,i),s(this,S).publish("updateSelfBoard",s(this,f).boardSnapshot)}if(s(this,C)===s(this,f)){const i=s(this,f).makeAttack(s(this,y),t,e);if(s(this,S).publish("updateOpponentBoard",s(this,y).boardSnapshot),s(this,y).areAllShipsSunk){a(this,g,ft).call(this);return}if(i.wasAlreadyHit)return;i.isShip||a(this,g,Z).call(this)}s(this,C)===s(this,y)&&s(this,M).call(this)}});o(this,M,async()=>{await(i=>new Promise(r=>setTimeout(r,i)))(500);const e=s(this,y).makeAttack(s(this,f));if(e){if(s(this,S).publish("updateSelfBoard",s(this,f).boardSnapshot),s(this,f).areAllShipsSunk){a(this,g,ft).call(this);return}if(e.wasAlreadyHit){console.log("attack.wasAlreadyHit"),await s(this,M).call(this);return}if(!e.isShip){a(this,g,Z).call(this);return}await s(this,M).call(this)}});o(this,Q,({x:t,y:e,e:i})=>{if(s(this,O))return;const r=s(this,f).getShipAtCoordinate(t,e);r&&s(this,S).publish("ghostCell",{coordinates:r.coordinatesSnapshot,e:i})});o(this,W,({draggedX:t,draggedY:e,targetX:i,targetY:r})=>{if(s(this,O))return;const n=s(this,f).getShipAtCoordinate(t,e);if(!n)return;const h=s(this,f).getShipDirection(n);if(!s(this,f).rePlaceShip(n,i,r,h)){s(this,S).publish("shakeShip",n.coordinatesSnapshot);return}s(this,S).publish("resetDraggedElement",s(this,f).boardSnapshot),s(this,S).publish("updateSelfBoard",s(this,f).boardSnapshot)});p(this,f,t),p(this,y,e),p(this,S,r),p(this,H,i)}init(){s(this,H).init(),a(this,g,pt).call(this),a(this,g,Lt).call(this)}}f=new WeakMap,y=new WeakMap,H=new WeakMap,S=new WeakMap,O=new WeakMap,X=new WeakMap,C=new WeakMap,g=new WeakSet,pt=function(){a(this,g,gt).call(this,s(this,f)),a(this,g,gt).call(this,s(this,y)),s(this,H).updateSelfBoard(s(this,f).boardSnapshot),s(this,H).updateOpponentBoard(s(this,y).boardSnapshot)},U=new WeakMap,K=new WeakMap,ft=function(){const t=s(this,C)===s(this,f)?"self":"opponent";s(this,S).publish("gameOver",t),p(this,X,!0)},Z=function(){s(this,S).publish("switchTurn"),p(this,C,s(this,C)===s(this,f)?s(this,y):s(this,f))},gt=function(t){const e={4:1,3:2,2:3,1:4};for(const[i,r]of Object.entries(e))for(let n=0;n<r;n++)t.placeShipAtRandom(new zt(Number(i)))},Lt=function(){const t={gameStart:s(this,U),restartGame:s(this,K),cellClick:s(this,J),dragStart:s(this,Q),drop:s(this,W)};for(const[e,i]of Object.entries(t))s(this,S).subscribe(e,i)},J=new WeakMap,M=new WeakMap,Ot=function(t){const e=s(this,f).changeShipDirection(t);return e||s(this,S).publish("shakeShip",t.coordinatesSnapshot),e},Q=new WeakMap,W=new WeakMap;var m,_,xt;class Bt{constructor(t){o(this,_);o(this,m);p(this,m,t)}placeShip(t,e,i,{dx:r,dy:n}){return s(this,m).placeShip(t,e,i,{dx:r,dy:n})}placeShipAtRandom(t){let e=!1;for(;!e;){const i=a(this,_,xt).call(this);if(i.length<1)return!1;const[r,n]=i[Math.floor(Math.random()*i.length)],h=Math.random()<.5,u=h?0:1,D=h?1:0;e=this.placeShip(t,r,n,{dx:u,dy:D})}return e}rePlaceShip(t,e,i,r){return s(this,m).rePlaceShip(t,e,i,r)}receiveAttack(t,e){return s(this,m).receiveAttack(t,e)}getShipAtCoordinate(t,e){return s(this,m).getShipAtCoordinate(t,e)}getShipDirection(t){return s(this,m).getShipDirection(t)}changeShipDirection(t){return s(this,m).changeShipDirection(t)}clearBoard(){s(this,m).clearBoard()}get areAllShipsSunk(){return s(this,m).areAllShipsSunk}get boardSnapshot(){return s(this,m).boardSnapshot}get hasLost(){return s(this,m).areAllShipsSunk}}m=new WeakMap,_=new WeakSet,xt=function(){const t=[];for(const[e,i]of this.boardSnapshot.entries())for(const[r,n]of i.entries())n||t.push([e,r]);return t};var tt,Tt;class Ut extends Bt{constructor(){super(...arguments);o(this,tt)}makeAttack(e){const i=a(this,tt,Tt).call(this,e.boardSnapshot);if(i.length===0)return null;const[r,n]=i[Math.floor(Math.random()*i.length)];return e.receiveAttack(r,n)}}tt=new WeakSet,Tt=function(e){const i=[];for(const[r,n]of e.entries())for(const[h,u]of n.entries())u!=null&&u.hit||i.push([r,h]);return i};var B,b,v,I,L,d,St,Nt,Ht,mt,x,bt,It,Rt,Yt,At;const w=class w{constructor(t=10){o(this,d);o(this,B);o(this,b);o(this,v);o(this,I);p(this,B,t),p(this,b,a(this,d,St).call(this,t)),p(this,v,new Set),p(this,I,0)}placeShip(t,e,i,r=s(w,L).HORIZONTAL){return a(this,d,Nt).call(this,t,e,i,r)?(a(this,d,Ht).call(this,t,e,i,r),s(this,v).add(t),!0):!1}rePlaceShip(t,e,i,r){if(!s(this,v).has(t))return!1;const[n,h,u]=a(this,d,At).call(this,t),D=r||u;return a(this,d,mt).call(this,t),this.placeShip(t,e,i,D)?!0:(this.placeShip(t,n,h,u),!1)}changeShipDirection(t){if(!s(this,v).has(t)||t.length<2)return!1;const[e,i,r]=a(this,d,At).call(this,t),n=a(this,d,Yt).call(this,r);return a(this,d,mt).call(this,t),this.placeShip(t,e,i,n)?!0:(this.placeShip(t,e,i,r),!1)}receiveAttack(t,e){if(a(this,d,x).call(this,t,e))return{isShip:!1,wasAlreadyHit:!1};const i=s(this,b)[t][e];if((i==null?void 0:i.hit)===!0)return{isShip:!!(i!=null&&i.ship),wasAlreadyHit:!0};if(!(i!=null&&i.ship))return s(this,b)[t][e]={hit:!0},{isShip:!1,wasAlreadyHit:!1};const r=i.ship,n=r.isSunk;return i.hit=!0,r.hit(),!n&&r.isSunk&&ut(this,I)._++,{isShip:!0,wasAlreadyHit:!1}}getShipAtCoordinate(t,e){if(a(this,d,x).call(this,t,e))return null;const i=s(this,b)[t][e];return(i==null?void 0:i.ship)||null}getShipDirection(t){const e=t.coordinatesSnapshot;if(e.length===1)return s(w,L).HORIZONTAL;const[i,r]=e[0],[n,h]=e[1];return i===n?s(w,L).HORIZONTAL:r===h?s(w,L).VERTICAL:null}clearBoard(){p(this,b,a(this,d,St).call(this,s(this,B))),s(this,v).clear(),p(this,I,0)}get areAllShipsSunk(){return s(this,v).size>0&&s(this,I)===s(this,v).size}get boardSnapshot(){return s(this,b).map(t=>t.map(e=>e?{...e}:null))}get fleetSnapshot(){return[...s(this,v)].map(t=>({length:t.length,hits:t.hits,isSunk:t.isSunk,coordinatesSnapshot:t.coordinatesSnapshot}))}get size(){return s(this,B)}};B=new WeakMap,b=new WeakMap,v=new WeakMap,I=new WeakMap,L=new WeakMap,d=new WeakSet,St=function(t){return[...Array(t)].map(()=>new Array(t).fill(null))},Nt=function(t,e,i,r){if(!t||s(this,v).has(t)||!a(this,d,bt).call(this,r))return!1;const n=e+r.dx*(t.length-1),h=i+r.dy*(t.length-1);return!(a(this,d,x).call(this,e,i)||a(this,d,x).call(this,n,h)||!a(this,d,It).call(this,t,e,i,r))},Ht=function(t,e,i,r){t.clearCoordinates();for(let n=0;n<t.length;n++){const h=e+r.dx*n,u=i+r.dy*n;s(this,b)[h][u]={ship:t,hit:!1},t.addCoordinate(h,u)}},mt=function(t){var i;const e=t.coordinatesSnapshot;if(!(!e||e.length===0)){for(const[r,n]of e)!a(this,d,x).call(this,r,n)&&((i=s(this,b)[r][n])==null?void 0:i.ship)===t&&(s(this,b)[r][n]=null);t.clearCoordinates(),s(this,v).delete(t)}},x=function(t,e){return t<0||e<0||t>=s(this,B)||e>=s(this,B)},bt=function(t){const{dx:e,dy:i}=t,{HORIZONTAL:r,VERTICAL:n}=s(w,L);return e===r.dx&&i===r.dy||e===n.dx&&i===n.dy},It=function(t,e,i,r){for(let n=0;n<t.length;n++){const h=e+r.dx*n,u=i+r.dy*n;if(s(this,b)[h][u]!==null||a(this,d,Rt).call(this,h,u,t))return!1}return!0},Rt=function(t,e,i=null){const r=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[n,h]of r){const u=t+n,D=e+h;if(a(this,d,x).call(this,u,D))continue;const j=s(this,b)[u][D];if(j!=null&&j.ship&&j.ship!==i)return!0}return!1},Yt=function(t){const{HORIZONTAL:e,VERTICAL:i}=s(w,L);return a(this,d,bt).call(this,t)?t.dx===e.dx?i:e:null},At=function(t){const e=t.coordinatesSnapshot;if(!e||e.length===0)return null;const[i,r]=e[0],n=this.getShipDirection(t);return[i,r,n]},o(w,L,{HORIZONTAL:{dx:0,dy:1},VERTICAL:{dx:1,dy:0}});let F=w;class Kt extends Bt{makeAttack(t,e,i){return t.receiveAttack(e,i)}}var R,$,z;class Jt{constructor(){o(this,$);o(this,R);p(this,R,new Map)}subscribe(t,e){const i=a(this,$,z).call(this,t);i.add(e),s(this,R).set(t,i)}publish(t,e){const i=a(this,$,z).call(this,t);for(const r of i)r(e)}unsubscribe(t,e){const i=a(this,$,z).call(this,t);i.delete(e),i.size===0&&s(this,R).delete(t)}}R=new WeakMap,$=new WeakSet,z=function(t){return s(this,R).get(t)||new Set};var E,G,A,k,Y,c,Pt,Xt,Mt,yt,vt,q,et,V,st,it,$t,kt,rt,Dt,nt,at,jt,Ct,Gt,ot,ht,lt,Et;class Qt{constructor(t){o(this,c);o(this,E);o(this,G);o(this,A);o(this,k);o(this,Y,null);ct(this,"updateSelfBoard",t=>a(this,c,yt).call(this,t,s(this,A)));ct(this,"updateOpponentBoard",t=>a(this,c,yt).call(this,t,s(this,k),!0));o(this,q,()=>{a(this,c,vt).call(this,!0)});o(this,et,()=>{a(this,c,vt).call(this,!1)});o(this,V,t=>{const e=t.target.closest(".cell");if(!e)return;const{x:i,y:r}=e.dataset;s(this,E).publish("cellClick",{x:+i,y:+r})});o(this,st,t=>{const e=t.target.closest(".ship");if(!e){t.preventDefault();return}p(this,Y,e);const{x:i,y:r}=e.dataset;s(this,E).publish("dragStart",{x:+i,y:+r,e:t})});o(this,it,t=>{const e=t.target.closest(".cell");if(!e)return;t.preventDefault();const{x:i,y:r}=s(this,Y).dataset,{x:n,y:h}=e.dataset;s(this,E).publish("drop",{draggedX:+i,draggedY:+r,targetX:+n,targetY:+h})});o(this,rt,t=>{t.target.remove(),s(this,E).publish("gameStart")});o(this,nt,()=>{const t=[s(this,A),s(this,k)];for(const e of t)e.classList.contains("disabled")?e.classList.remove("disabled"):e.classList.add("disabled")});o(this,at,t=>{const e=[s(this,A),s(this,k)];for(const r of e)r.classList.add("disabled");const i={self:"You win!",opponent:"You lost!"};a(this,c,jt).call(this,i[t])});o(this,ot,()=>{for(const t of s(this,A).querySelectorAll(".cell"))t.removeAttribute("draggable")});o(this,ht,t=>{for(const[e,i]of t){const r=s(this,A).querySelector(`[data-x="${e}"][data-y="${i}"]`);r==null||r.classList.add("shake"),r==null||r.addEventListener("animationend",()=>r.classList.remove("shake"),{once:!0})}});o(this,lt,()=>{var t;(t=s(this,Y))==null||t.removeAttribute("draggable"),p(this,Y,null)});p(this,G,document.getElementById("app")),p(this,E,t)}init(t=10){a(this,c,Pt).call(this,t),a(this,c,kt).call(this),a(this,c,Xt).call(this),a(this,c,Mt).call(this)}get selfBoardEl(){return s(this,A)}get opponentBoardEl(){return s(this,k)}}E=new WeakMap,G=new WeakMap,A=new WeakMap,k=new WeakMap,Y=new WeakMap,c=new WeakSet,Pt=function(t){p(this,A,a(this,c,Dt).call(this,"self")),p(this,k,a(this,c,Dt).call(this,"opponent",!0)),a(this,c,Ct).call(this,s(this,A),t),a(this,c,Ct).call(this,s(this,k),t)},Xt=function(){s(this,A).addEventListener("click",s(this,V)),s(this,k).addEventListener("click",s(this,V)),s(this,q).call(this)},Mt=function(){const t={updateSelfBoard:this.updateSelfBoard,updateOpponentBoard:this.updateOpponentBoard,shakeShip:s(this,ht),ghostCell:a(this,c,$t),resetDraggedElement:s(this,lt),clearDraggableAttr:s(this,ot),disableDragAndDropListeners:s(this,et),enableDragAndDropListeners:s(this,q),switchTurn:s(this,nt),gameOver:s(this,at)};for(const[e,i]of Object.entries(t))s(this,E).subscribe(e,i)},yt=function(t,e,i=!1){a(this,c,Gt).call(this,e);for(const[r,n]of t.entries())for(const[h,u]of n.entries()){const D=e.querySelector(`[data-x="${r}"][data-y="${h}"]`);u!=null&&u.hit?D.classList.add(u.ship?"hit":"miss"):!i&&(u!=null&&u.ship)&&(D.classList.add("ship"),D.draggable=!0)}},vt=function(t){const e=t?"addEventListener":"removeEventListener",i={dragstart:s(this,st),dragenter:a(this,c,Et),dragover:a(this,c,Et),drop:s(this,it)};for(const[r,n]of Object.entries(i))s(this,A)[e](r,n)},q=new WeakMap,et=new WeakMap,V=new WeakMap,st=new WeakMap,it=new WeakMap,$t=function({coordinates:t,e}){const i=t[0][0]===t.at(-1)[0],r=document.createElement("div"),n=t.length,h=2.2;r.className="ghost",r.style.width=`${i?n*h:h}em`,r.style.height=`${i?h:n*h}em`,document.body.appendChild(r),e.dataTransfer.setDragImage(r,0,0),setTimeout(()=>r.remove(),0)},kt=function(){const t=document.createElement("button");t.textContent="Start",t.className="start",t.addEventListener("click",s(this,rt)),s(this,k).parentNode.appendChild(t)},rt=new WeakMap,Dt=function(t,e=!1){const i=document.createElement("div"),r=document.createElement("div");return i.className=`battlefied_${t}`,r.className=`board ${t} ${e?"disabled":""}`,i.appendChild(r),s(this,G).appendChild(i),r},nt=new WeakMap,at=new WeakMap,jt=function(t){const e=document.createElement("div");e.className="modal-overlay";const i=document.createElement("div");i.className="modal-content";const r=document.createElement("p");r.textContent=t;const n=document.createElement("button");n.className="restart-btn",n.textContent="Restart",n.addEventListener("click",h=>{s(this,E).publish("restartGame");const u=h.target.closest(".modal-overlay");u==null||u.remove(),s(this,A).classList.remove("disabled"),a(this,c,kt).call(this)}),i.appendChild(r),i.appendChild(n),e.appendChild(i),document.querySelector("body").appendChild(e)},Ct=function(t,e){const i=document.createDocumentFragment();for(let r=0;r<e;r++)for(let n=0;n<e;n++){const h=document.createElement("div");h.classList.add("cell"),h.dataset.x=r,h.dataset.y=n,i.appendChild(h)}t.appendChild(i)},Gt=function(t){for(const e of t.querySelectorAll(".cell"))e.classList.remove("ship","hit","miss"),e.removeAttribute("draggable")},ot=new WeakMap,ht=new WeakMap,lt=new WeakMap,Et=function(t){t.target.closest(".cell")&&t.preventDefault()};const qt=new Jt,Wt=new F,_t=new Kt(Wt),te=new F,ee=new Ut(te),se=new Qt(qt),ie=new Ft(_t,ee,se,qt);ie.init();
